<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingenier√≠a de Tanques - Panel Final</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 10px; }
        .card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; border-top: 5px solid #1a73e8; }
        h3 { margin: 0 0 10px 0; font-size: 0.9em; text-align: center; text-transform: uppercase; color: #1a73e8; }
        #status { text-align: center; font-size: 0.75em; margin-bottom: 10px; font-weight: bold; }
        .grid-datos { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
        .box-edit { background: #f8f9fa; border: 1px solid #ddd; padding: 5px 8px; border-radius: 8px; }
        .label { font-size: 0.65em; color: #666; font-weight: bold; text-transform: uppercase; display: block; }
        .input-edit { width: 100%; border: none; background: transparent; color: #1a73e8; font-weight: bold; font-size: 14px; padding: 2px 0; outline: none; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #1a73e8; font-size: 16px; margin-bottom: 10px; font-weight: bold; }
        .btn { width: 100%; padding: 15px; border-radius: 10px; border: none; font-size: 14px; font-weight: bold; cursor: pointer; margin-top: 8px; display: flex; align-items: center; justify-content: center; }
        .btn-save { background: #2e7d32; color: white; }
    </style>
</head>
<body>

    <div class="card">
        <h3>üìã CONTROL DE TANQUES</h3>
        <div id="status">Conectando...</div>
        <select id="listaTanques" onchange="cambiarTanque()">
            <option>Cargando datos...</option>
        </select>
        
        <div class="grid-datos">
            <div class="box-edit"><span class="label">ID (A)</span><input id="c1" class="input-edit" type="text"></div>
            <div class="box-edit"><span class="label">VOL (B)</span><input id="c2" class="input-edit" type="text"></div>
            <div class="box-edit"><span class="label">DIAM (C)</span><input id="c3" class="input-edit" type="text"></div>
            <div class="box-edit"><span class="label">ALT (D)</span><input id="c4" class="input-edit" type="text"></div>
            <div class="box-edit"><span class="label">DENS (E)</span><input id="c5" class="input-edit" type="text"></div>
            <div class="box-edit"><span class="label">SENS (F)</span><input id="c6" class="input-edit" type="text"></div>
            <div class="box-edit"><span class="label">COM (G)</span><input id="c7" class="input-edit" type="text"></div>
            <div class="box-edit"><span class="label">ESTADO (H)</span><input id="c8" class="input-edit" type="text"></div>
        </div>

        <button class="btn btn-save" onclick="enviarExcel()">üíæ GUARDAR EN GOOGLE SHEETS</button>
    </div>

<script>
    // URL ACTUALIZADA SEG√öN TU MENSAJE
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwYy1e5eL6P7rEay4U1X99pY7tY6E17_E58899808386348634/exec"; 

    let datosExcel = [];

    async function cargarTanques() {
        const st = document.getElementById('status');
        try {
            const r = await fetch(SCRIPT_URL);
            datosExcel = await r.json();
            let html = "";
            datosExcel.forEach((f, i) => { html += `<option value="${i}">${f[0] || 'Tanque '+(i+1)}</option>`; });
            document.getElementById('listaTanques').innerHTML = html;
            st.innerText = "‚úÖ CONECTADO CON √âXITO";
            st.style.color = "green";
            cambiarTanque();
        } catch(e) { 
            st.innerText = "‚ùå ERROR: Revisa permisos en Google Script";
            st.style.color = "red";
        }
    }

    function cambiarTanque() {
        const i = document.getElementById('listaTanques').value;
        const t = datosExcel[i];
        if(!t) return;
        for(let j=1; j<=8; j++) {
            document.getElementById('c'+j).value = t[j-1] || "";
        }
    }

    function enviarExcel() {
        const i = document.getElementById('listaTanques').value;
        const payload = {
            fila: parseInt(i) + 2,
            datos: [
                document.getElementById('c1').value, document.getElementById('c2').value,
                document.getElementById('c3').value, document.getElementById('c4').value,
                document.getElementById('c5').value, document.getElementById('c6').value,
                document.getElementById('c7').value, document.getElementById('c8').value
            ]
        };
        fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) })
        .then(() => alert("‚úÖ Datos guardados correctamente"));
    }

    window.onload = cargarTanques;
</script>
</body>
</html>
